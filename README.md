### Starling Bank Challenge

For a customer, take all the transactions in a given week and round them up to the nearest
pound. For example with spending of £4.35, £5.20 and £0.87, the round-up would be £1.58.
This amount should then be transferred into a savings goal, helping the customer save for
future adventures.

### Running the app
```bash
export STARLING_API_BASEURL=https://api-sandbox.starlingbank.com/api/v2/ STARTLING_API_BEARER_TOKEN={yourApplicationBearerToken} && ./gradlew bootRun
```

### Running with Docker
```bash
# run build
./gradlew clean build

# build image
 docker build -t roundup-app .
 
 # run
 docker run -p 8080:8080 -d -e STARLING_API_BASEURL='https://api-sandbox.starlingbank.com/api/v2/' -e STARLING_API_BEARER_TOKEN='yourApplicationBearerToken' roundup-app
```

### Testing
```curl
curl -X PUT \
  http://localhost:8080/round-save \
  -H 'Content-Type: application/json' \
  -d '{"savingsGoalName": "Buy a car", "since": "2024-06-25"}'
```

## How it works
#### Flow Diagram
![Flow Diagram](https://github.com/adigunhammedolalekan/starling-challenge/blob/main/flows/roundup_flows.png)

* Client make an API call to the endpoint `PUT /round-save`
  * ```json
    PUT /round-save
    {
        "savingsGoalName": "Hammed Holiday",
        "since": "2024-06-20
    }
    ```
  * savingsGoalName: Optional - the name of the SavingsGoal client wishes to save the rounded amount. Defaults to `Hammed Savings` if null is given
  * since: Optional - Date from when transactions rounding should start. Defaults to 1week ago if null is given
* RoundingController receives the request and pass it to RoundingService
* RoundingService:
  * fetch primary account using APIIntegrationService
  * fetch transactions using the parameter from the request and the fetched account
    * filter out non-eligible transactions using the criteria:
      * direction = OUT
      * status = SETTLED
      * amount > 0
      * source != INTERNAL_TRANSFERS
      * spendingCategory != SAVING
    * filtering out the non-eligible transactions ensures we only round transactions that are outbound, completed and not a transaction generated by transferring to the same or another SavingGoal 
  * call SavingsGoalService passing the account, the savingsGoalName and the eligible transactions
* SavingsGoalService:
  * calculate the total rounded amount
  * create or get a SavingsGoal - this is based on if the name already exists
  * add money to the SavingsGoal from the step above